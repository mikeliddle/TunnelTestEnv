events {}
http {
	server_names_hash_bucket_size 128;
	include mime.types;
	default_type application/octet-stream;

	server {
		listen 80;

		server_name _;

		location / {
			root /etc/volume/nginx_data;
			index index.html;
		}

		error_page	500 502 503 504	 /50x.html;
		location = /50x.html {
			root	/etc/volume/nginx_data;
		}
	}

	server {
	    listen 443 ssl;
	    
		ssl_certificate /etc/volume/certs/letsencrypt.pem;
	    ssl_certificate_key /etc/volume/private/letsencrypt.key;

	    server_name ##DOMAIN_NAME## _;
	    server_tokens off;

	    location / {
	        root   /etc/volume/nginx_data;
	        index  index.html;
	    }
	    # redirect server error pages to the static page /50x.html
	    #
	    error_page   500 502 503 504  /50x.html;
	    location = /50x.html {
	        root   /etc/volume/nginx_data;
	    }
	}

	server {
		listen 443 ssl;
		
		ssl_certificate	/etc/volume/certs/untrusted.pem;
		ssl_certificate_key	/etc/volume/private/untrusted.key;

		server_name untrusted.##DOMAIN_NAME## untrusted;
		server_tokens	off;

		location / {
			root	/etc/volume/nginx_data;
			index	untrusted.html;
		}

		# redirect server error pages to the static page /50x.html
	    #
	    error_page   500 502 503 504  /50x.html;
	    location = /50x.html {
	        root   /etc/volume/nginx_data;
	    }
	}

	server {
		listen 80;

		server_name webapp.##DOMAIN_NAME## webapp;

		location / {
			proxy_pass https://##SERVER_IP##:8081;
			proxy_redirect	off;
			proxy_ssl_verify	off;
			proxy_set_header         X-Real-IP           $remote_addr;
			proxy_set_header         X-Forwarded-For     $proxy_add_x_forwarded_for;
			proxy_set_header         X-Forwarded-Proto   $scheme;
		}

		# redirect server error pages to the static page /50x.html
	    #
	    error_page   500 502 503 504  /50x.html;
	    location = /50x.html {
	        root   /etc/volume/nginx_data;
	    }
	}

	server {
		listen 443 ssl;

		ssl_certificate /etc/volume/certs/serverchain.pem;
		ssl_certificate_key /etc/volume/private/server.key;

		server_name webapp.##DOMAIN_NAME## webapp;

		location / {
			proxy_pass https://##SERVER_IP##:8443;
			proxy_redirect	off;
			proxy_set_header         X-Real-IP           $remote_addr;
			proxy_set_header         X-Forwarded-For     $proxy_add_x_forwarded_for;
			proxy_set_header         X-Forwarded-Proto   $scheme;
		}

		# redirect server error pages to the static page /50x.html
	    #
	    error_page   500 502 503 504  /50x.html;
	    location = /50x.html {
	        root   /etc/volume/nginx_data;
	    }
	}

	server {
		listen 80;

		server_name excluded.##DOMAIN_NAME## excluded;

		location / {
			proxy_pass https://##SERVER_IP##:8081;
			proxy_redirect	off;
			proxy_set_header         X-Real-IP           $remote_addr;
			proxy_set_header         X-Forwarded-For     $proxy_add_x_forwarded_for;
			proxy_set_header         X-Forwarded-Proto   $scheme;
		}

		# redirect server error pages to the static page /50x.html
	    #
	    error_page   500 502 503 504  /50x.html;
	    location = /50x.html {
	        root   /etc/volume/nginx_data;
	    }
	}

	server {
		listen 443 ssl;

		ssl_certificate /etc/volume/certs/serverchain.pem;
		ssl_certificate_key /etc/volume/private/server.key;

		server_name excluded.##DOMAIN_NAME## excluded;

		location / {
			proxy_pass https://##SERVER_IP##:8443;
			proxy_redirect	off;
			proxy_ssl_verify	off;
			proxy_set_header         X-Real-IP           $remote_addr;
			proxy_set_header         X-Forwarded-For     $proxy_add_x_forwarded_for;
			proxy_set_header         X-Forwarded-Proto   $scheme;
		}

		# redirect server error pages to the static page /50x.html
	    #
	    error_page   500 502 503 504  /50x.html;
	    location = /50x.html {
	        root   /etc/volume/nginx_data;
	    }
	}

	server {
		listen 443 ssl;

		server_name 		cert.##DOMAIN_NAME## cert;
		ssl_certificate 	/etc/volume/certs/serverchain.pem;
		ssl_certificate_key /etc/volume/private/server.key;
		ssl_protocols		TLSv1.2 TLSv1.3;
		ssl_ciphers			HIGH:!aNULL:!MD5;

		ssl_client_certificate /etc/volume/certs/cacert.pem;
		ssl_verify_client		on;
		ssl_verify_depth		2;

		location / {
	        root   /etc/volume/nginx_data;
	        index  trusted.html;
	    }
	    # redirect server error pages to the static page /50x.html
	    #
	    error_page   500 502 503 504  /50x.html;
	    location = /50x.html {
	        root   /etc/volume/nginx_data;
	    }
	}

	server {
		listen 443 ssl;

		server_name 		optionalcert.##DOMAIN_NAME## optionalcert;
		ssl_certificate 	/etc/volume/certs/serverchain.pem;
		ssl_certificate_key /etc/volume/private/server.key;
		ssl_protocols		TLSv1.2 TLSv1.3;
		ssl_ciphers			HIGH:!aNULL:!MD5;

		ssl_client_certificate /etc/volume/certs/cacert.pem;
		ssl_verify_client		optional;
		ssl_verify_depth		2;

		location / {
	        root   /etc/volume/nginx_data;
	        index  trusted.html;
	    }
	    # redirect server error pages to the static page /50x.html
	    #
	    error_page   500 502 503 504  /50x.html;
	    location = /50x.html {
	        root   /etc/volume/nginx_data;
	    }
	}
}